<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aplikasi Cuti RRI Sibolga</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    function CatatanPopup({ show, onClose, label, isAdmin, initialNote, onSave }) {
      const [note, setNote] = useState(initialNote || "");
      if (!show) return null;
      return (
        <div className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
          <div className="bg-white p-4 rounded shadow-lg w-96">
            <h2 className="text-lg font-bold mb-2">Catatan {label}</h2>
            {isAdmin ? (
              <textarea
                className="w-full border p-2 rounded mb-2"
                rows="4"
                value={note}
                onChange={(e) => setNote(e.target.value)}
              />
            ) : (
              <p className="p-2 border rounded bg-gray-50 min-h-[80px]">
                {note || "Belum ada catatan."}
              </p>
            )}
            <div className="flex justify-end space-x-2">
              <button
                className="px-4 py-2 bg-gray-300 rounded"
                onClick={onClose}
              >
                Tutup
              </button>
              {isAdmin && (
                <button
                  className="px-4 py-2 bg-blue-500 text-white rounded"
                  onClick={() => {
                    onSave(note);
                    onClose();
                  }}
                >
                  Simpan
                </button>
              )}
            </div>
          </div>
        </div>
      );
    }
    function UserPanel({ cuti }) {
      const [showPopup, setShowPopup] = useState(false);
      const [selectedLabel, setSelectedLabel] = useState("");
      const [selectedNote, setSelectedNote] = useState("");

      const handleOpen = (label, note) => {
        setSelectedLabel(label);
        setSelectedNote(note || "");
        setShowPopup(true);
      };

      const cutiList = [
        { key: "annual", label: "Cuti Tahunan Terpakai", value: cuti.annualUsed },
        { key: "big", label: "Cuti Besar Terpakai", value: cuti.bigUsed },
        { key: "sick", label: "Cuti Sakit Terpakai", value: cuti.sickUsed },
        { key: "maternity", label: "Cuti Melahirkan Terpakai", value: cuti.maternityUsed },
        { key: "important", label: "Cuti Alasan Penting Terpakai", value: cuti.importantUsed },
        { key: "unpaid", label: "Cuti Di Luar Tanggungan Terpakai", value: cuti.unpaidUsed }
      ];

      return (
        <div>
          {cutiList.map((item) => (
            <div
              key={item.key}
              className="p-2 mb-2 bg-white shadow rounded cursor-pointer hover:bg-gray-50"
              onClick={() => handleOpen(item.label, cuti.notes?.[item.key])}
            >
              {item.label}: {item.value || 0}
            </div>
          ))}
          <CatatanPopup
            show={showPopup}
            onClose={() => setShowPopup(false)}
            label={selectedLabel}
            isAdmin={false}
            initialNote={selectedNote}
            onSave={() => {}}
          />
        </div>
      );
    }

    function AdminPanel({ pegawai, updateCuti }) {
      const [showPopup, setShowPopup] = useState(false);
      const [selectedLabel, setSelectedLabel] = useState("");
      const [selectedKey, setSelectedKey] = useState("");
      const [selectedPegawai, setSelectedPegawai] = useState(null);
      const [selectedNote, setSelectedNote] = useState("");

      const handleOpen = (label, key, pegawai) => {
        setSelectedLabel(label);
        setSelectedKey(key);
        setSelectedPegawai(pegawai);
        setSelectedNote(pegawai.notes?.[key] || "");
        setShowPopup(true);
      };

      const handleSaveNote = (note) => {
        if (!selectedPegawai || !selectedKey) return;
        firebase.firestore().collection("cuti").doc(selectedPegawai.id).update({
          [`notes.${selectedKey}`]: note
        });
      };

      return (
        <div>
          {pegawai.map((p) => (
            <div key={p.id} className="p-4 mb-4 bg-white rounded shadow">
              <h3 className="font-bold">{p.nama}</h3>
              <div className="grid grid-cols-2 gap-2 mt-2">
                <button
                  className="bg-blue-500 text-white px-2 py-1 rounded"
                  onClick={() => handleOpen("Cuti Tahunan Terpakai", "annual", p)}
                >
                  Catatan Tahunan
                </button>
                <button
                  className="bg-blue-500 text-white px-2 py-1 rounded"
                  onClick={() => handleOpen("Cuti Besar Terpakai", "big", p)}
                >
                  Catatan Besar
                </button>
                <button
                  className="bg-blue-500 text-white px-2 py-1 rounded"
                  onClick={() => handleOpen("Cuti Sakit Terpakai", "sick", p)}
                >
                  Catatan Sakit
                </button>
                <button
                  className="bg-blue-500 text-white px-2 py-1 rounded"
                  onClick={() => handleOpen("Cuti Melahirkan Terpakai", "maternity", p)}
                >
                  Catatan Melahirkan
                </button>
                <button
                  className="bg-blue-500 text-white px-2 py-1 rounded"
                  onClick={() => handleOpen("Cuti Alasan Penting Terpakai", "important", p)}
                >
                  Catatan Penting
                </button>
                <button
                  className="bg-blue-500 text-white px-2 py-1 rounded"
                  onClick={() => handleOpen("Cuti Di Luar Tanggungan Terpakai", "unpaid", p)}
                >
                  Catatan Di Luar Tanggungan
                </button>
              </div>
            </div>
          ))}
          <CatatanPopup
            show={showPopup}
            onClose={() => setShowPopup(false)}
            label={selectedLabel}
            isAdmin={true}
            initialNote={selectedNote}
            onSave={handleSaveNote}
          />
        </div>
      );
    }
    function App() {
      const [mode, setMode] = useState("user");
      const [pegawai, setPegawai] = useState([]);
      const [cutiUser, setCutiUser] = useState({});

      useEffect(() => {
        const unsubscribe = firebase.firestore().collection("cuti").onSnapshot((snapshot) => {
          const data = [];
          snapshot.forEach((doc) => {
            data.push({ id: doc.id, ...doc.data() });
          });
          setPegawai(data);
          if (mode === "user" && data.length > 0) {
            setCutiUser(data[0]); // sementara: ambil pegawai pertama
          }
        });
        return () => unsubscribe();
      }, [mode]);

      return (
        <div className="p-4">
          <div className="flex justify-between items-center mb-4">
            <h1 className="text-2xl font-bold">Aplikasi Cuti RRI Sibolga</h1>
            <button
              className="bg-green-500 text-white px-4 py-2 rounded"
              onClick={() => setMode(mode === "user" ? "admin" : "user")}
            >
              {mode === "user" ? "Beralih ke Admin" : "Beralih ke User"}
            </button>
          </div>
          {mode === "user" ? (
            <UserPanel cuti={cutiUser} />
          ) : (
            <AdminPanel pegawai={pegawai} updateCuti={() => {}} />
          )}
        </div>
      );
    }

    const firebaseConfig = {
      // konfigurasi Firebase kamu di sini
    };
    firebase.initializeApp(firebaseConfig);

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
