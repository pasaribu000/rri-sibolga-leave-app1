<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aplikasi Cuti RRI Sibolga</title>
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Firebase COMPAT (namespaced) to avoid bundlers -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <!-- Lucide (browser) -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    /* Prevent FOUC for lucide icons */
    i[data-lucide] { display: inline-block; vertical-align: middle; }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-indigo-200 min-h-screen antialiased flex items-center justify-center p-4">
  <div id="root" class="w-full max-w-2xl mx-auto my-8"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState, useRef } = React;
    const { createRoot } = ReactDOM;

    // ====== Firebase Config (SAMA seperti file Anda) ======
    const firebaseConfig = {
      apiKey: "AIzaSyBBDMhvpAboYaEUIfo0eyzjZxK6iZyQwpo",
      authDomain: "cutirri.firebaseapp.com",
      projectId: "cutirri",
      storageBucket: "cutirri.firebasestorage.app",
      messagingSenderId: "310950239670",
      appId: "1:310950239670:web:3b58351db2c5946f8c3517",
      measurementId: "G-BENDLYTZ2Z"
    };

    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const correctAdminPassword = "rriadmin2025";
    const initialEmployees = ["Yanni Peter Latuheru, S.Sos", "Ichwansyah Pohan, S.E", "Rosmawan Hutabarat, S.E", "Viktor Hamonangan Hutabarat", "Khairil", "Vivi Tri Doharny Daulay", "Diskatarisa Hutabarat", "Novita Sari Putri S.E", "Silverius Hamonangan P. Purba, S.Sos", "Frans Martuani Sinaga, S.M", "Ade Wulan Septyaningsih, S.IP", "Nurhamni Ichwarti, S.Sos", "Citra Priadi Pasaribu, S.IP", "Azis Fahri Tanjung, S.Kom", "Annisa Lestari Nasution, A.Md.Ak", "Putri Andriani, A.Md.Ak", "Mahani Aprilia, A.Md.Ak", "Idola Pratiwi Sinaga, A.md.Pjk", "Ray Wiranta, A.Md.A.B", "Indah Farima Putri, A.Md", "Hans Pierre Sitohang, A.Md", "Sopiah Hasibuan, A.Md", "Aziziah khurfatul Janah, A.Md.Ds", "Astrid khairani Sinaga, A.Md", "Intan Friskila hondro, A.Md", "Anna Theresia Simatupang, S.Sos", "Desi Suriani Pasaribu, S.E", "Rindu Fatmawaty, S.H", "Gerhanawati, S.E", "Ismail Marzuki, S.Sos", "Ronny Ferdian, S.E", "Safran Nuh Nasution, S.T", "M.Khalis Pasaribu, S.Ikom", "Eko Putra Hutabarat, A.Md", "Ahmad Ridho Siregar, A.Md.T", "Ahlis Jami'ah Damanik, A.Md.Kom", "Deliana Nasution", "Widya Sartika Nasution", "Paulus Hadi", "Ahmad Ferdian", "Anhar Rianto Pasaribu", "Deny Siahaan", "Abdul Jalil", "Dedi Hariadi", "Edi Suheri", "Muafdan Jega", "Joyful Rom Sihotang", "James Fransiskus", "Jonni Sihombing", "Martha Monica Putri Siahaan, S.T", "Erni Sasmita, S.E", "Wilson Pangihutan Siregar", "Welly Boy Simatupang, S.E", "Eva Meylina Siahaan", "Flora Susanti Lumbantobing", "Ester Tampubolon", "Bernard Adi Saputra Saragih", "Felix Simatupang", "Mukhtadinul Ikhsan", "Halasson Siahaan", "Mahar Yusuf Sinaga", "Irfan Sihotang", "Rizky Ramadhan Piliang", "Andrian Mendrofa"];

    const leaveTypes = [
      { key: 'annual', label: 'Cuti Tahunan Terpakai' },
      { key: 'long', label: 'Cuti Besar Terpakai' },
      { key: 'sick', label: 'Cuti Sakit Terpakai' },
      { key: 'maternity', label: 'Cuti Melahirkan Terpakai' },
      { key: 'important', label: 'Cuti Alasan Penting Terpakai' },
      { key: 'outside', label: 'Cuti Di Luar Tanggungan Terpakai' },
    ];
    
    // Fungsi untuk menguraikan data CSV, tidak diubah
    const parseCSV = (csv) => {
      const lines = csv.split('\n');
      const headers = ['Timestamp', 'Nama Pegawai', 'Jenis Cuti', 'Tanggal Mulai Cuti', 'Tanggal Selesai Cuti', 'Unggah Berkas Persyaratan', 'Alamat Email Pegawai'];
      const data = [];
      const numExpectedColumns = headers.length;

      for (let i = 1; i < lines.length; i++) {
        if (lines[i].trim() === '') continue;
        const values = lines[i].split(',').map(v => v.trim());
        const obj = {};

        if (values.length > numExpectedColumns) {
          const timestamp = values[0];
          const email = values[values.length - 1];
          const uploadLink = values[values.length - 2];
          const endDate = values[values.length - 3];
          const startDate = values[values.length - 4];
          const leaveType = values[values.length - 5];
          
          const nameParts = values.slice(1, values.length - 5);
          const name = nameParts.join(', ');

          const newValues = [timestamp, name, leaveType, startDate, endDate, uploadLink, email];
          
          headers.forEach((header, index) => {
            obj[header] = newValues[index];
          });

        } else {
          headers.forEach((header, index) => {
            obj[header] = values[index];
          });
        }
        data.push(obj);
      }
      return data;
    };

    // Komponen Header, tidak diubah
    function Header({ currentTime }) {
      useEffect(() => { lucide.createIcons(); });
      return (
        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
          <div className="flex items-center space-x-4">
            <i data-lucide="radio" className="w-10 h-10 text-indigo-600"></i>
            <h1 className="text-4xl font-bold text-gray-800 tracking-wide">RRI Sibolga</h1>
          </div>
          <div className="text-right">
            <p className="text-lg font-medium text-gray-600">
              {currentTime.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
            </p>
            <p className="text-2xl font-bold text-indigo-600">
              {currentTime.toLocaleTimeString('id-ID')}
            </p>
          </div>
        </div>
      );
    }

    // Komponen Kalender, tidak diubah
    function Calendar({ onClose }) {
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const daysInMonth = useMemo(() => {
        const year = currentMonth.getFullYear();
        const month = currentMonth.getMonth();
        const lastDay = new Date(year, month + 1, 0).getDate();
        return Array.from({ length: lastDay }, (_, i) => i + 1);
      }, [currentMonth]);

      const firstDayOffset = useMemo(() => {
        const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
        return firstDay.getDay();
      }, [currentMonth]);

      const monthYear = currentMonth.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });

      useEffect(() => { lucide.createIcons(); });

      return (
        <div className="bg-white rounded-2xl shadow-xl p-8 space-y-6 max-w-2xl w-full border-t-8 border-yellow-500">
          <div className="flex items-center justify-between mb-4">
            <button onClick={() => setCurrentMonth(d => new Date(d.getFullYear(), d.getMonth()-1, 1))} className="p-2 rounded-full hover:bg-gray-200">
              <i data-lucide="chevron-left" className="w-6 h-6"></i>
            </button>
            <h3 className="text-xl font-bold text-gray-800">{monthYear}</h3>
            <button onClick={() => setCurrentMonth(d => new Date(d.getFullYear(), d.getMonth()+1, 1))} className="p-2 rounded-full hover:bg-gray-200">
              <i data-lucide="chevron-right" className="w-6 h-6"></i>
            </button>
          </div>
          <div className="grid grid-cols-7 gap-2 text-center text-sm font-medium text-gray-500">
            {['Min','Sen','Sel','Rab','Kam','Jum','Sab'].map(d => <div key={d}>{d}</div>)}
          </div>
          <div className="grid grid-cols-7 gap-2">
            {Array.from({ length: firstDayOffset }).map((_,i)=>(<div key={'e'+i} className="p-2"></div>))}
            {daysInMonth.map(day => (
              <div key={day} className="p-3 bg-gray-100 rounded-lg text-center font-medium transition-all hover:bg-indigo-200 cursor-pointer">
                {day}
              </div>
            ))}
          </div>
          <button onClick={onClose} className="mt-8 w-full flex items-center justify-center px-6 py-3 bg-red-500 text-white font-bold rounded-full text-lg hover:bg-red-600 shadow-lg">
            <i data-lucide="x" className="w-5 h-5 mr-2"></i> Tutup Kalender
          </button>
        </div>
      );
    }
    
    // Komponen utama aplikasi
    function App() {
      const [currentTime, setCurrentTime] = useState(new Date());
      const [isLoading, setIsLoading] = useState(true);
      const [userId, setUserId] = useState(null);
      const [isAdmin, setIsAdmin] = useState(false);
      const [showPasswordInput, setShowPasswordInput] = useState(false);
      const [adminPassword, setAdminPassword] = useState('');
      const [message, setMessage] = useState({ text: '', type: '' });
      const [employees, setEmployees] = useState([]);
      const [leaveQuotas, setLeaveQuotas] = useState([]);
      const [selectedEmployee, setSelectedEmployee] = useState(null);
      const [searchQuery, setSearchQuery] = useState('');
      const [editData, setEditData] = useState({});
      const [isSaving, setIsSaving] = useState({});
      const [showFlow, setShowFlow] = useState(false);
      const [showCalendar, setShowCalendar] = useState(false);
      const [showForm, setShowForm] = useState(false);
      const [showConfirmation, setShowConfirmation] = useState(false);

      useEffect(() => { lucide.createIcons(); });

      // Effect untuk memperbarui waktu
      useEffect(() => {
        const t = setInterval(() => setCurrentTime(new Date()), 1000);
        return () => clearInterval(t);
      }, []);

      // Effect untuk otentikasi Firebase
      useEffect(() => {
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const stop = firebase.onAuthStateChanged(auth, u => {
          setUserId(u ? u.uid : null);
          setIsLoading(false);
        });
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        if (initialAuthToken) {
          firebase.signInWithCustomToken(auth, initialAuthToken);
        } else {
          firebase.signInAnonymously(auth);
        }
        return () => stop();
      }, []);

      // Effect untuk mengambil data pegawai
      useEffect(() => {
        if (!userId) return;
        const db = firebase.firestore();
        const ref = db.collection(`artifacts/${appId}/public/data/employees`);

        const ensureSeed = async () => {
          const snap = await ref.get();
          if (snap.empty) {
            const batch = db.batch();
            initialEmployees.forEach(name => {
              const docRef = ref.doc();
              batch.set(docRef, {
                name,
                leaves: { annual:0, long:0, sick:0, maternity:0, important:0, outside:0 }
              });
            });
            await batch.commit();
          }
        };

        ensureSeed().catch(console.error);

        const unsub = ref.onSnapshot(snap => {
          const arr = snap.docs.map(d => ({ id: d.id, ...d.data() }));
          setEmployees(arr);
          if (!selectedEmployee && arr.length) setSelectedEmployee(arr[0]);
        }, err => {
          console.error(err);
          setMessage({ text: "Gagal memuat data cuti.", type: "error" });
        });
        return () => unsub();
      }, [userId]);

      // Effect untuk mengambil data kuota cuti
      useEffect(() => {
        if (!userId) return;
        const db = firebase.firestore();
        const ref = db.collection(`artifacts/${appId}/public/data/leaveQuotas`);

        const initialQuotas = [
          { type: 'Cuti Tahunan', quota: '12 hari', order: 1, note: '' },
          { type: 'Cuti Besar', quota: '3 bulan', order: 2, note: '' },
          { type: 'Cuti Sakit', quota: '14 hari', order: 3, note: '' },
          { type: 'Cuti Melahirkan', quota: '3 bulan', order: 4, note: '' },
          { type: 'Cuti Karena Alasan Penting', quota: '1 bulan', order: 5, note: '' },
          { type: 'Cuti Diluar Tanggungan Negara', quota: '3 tahun', order: 6, note: '' },
          { type: 'Cuti Bersama', quota: '7 hari', note: 'sewaktu-waktu dapat berubah', order: 7 },
        ];

        const ensureSeed = async () => {
          const snap = await ref.get();
          if (snap.empty) {
            const batch = db.batch();
            initialQuotas.forEach(q => {
              const docRef = ref.doc();
              batch.set(docRef, q);
            });
            await batch.commit();
          }
        };

        ensureSeed().catch(console.error);

        const unsub = ref.onSnapshot(snap => {
          const arr = snap.docs.map(d => ({ id: d.id, ...d.data() }));
          setLeaveQuotas(arr);
        }, err => {
          console.error(err);
          setMessage({ text: "Gagal memuat kuota cuti.", type: "error" });
        });
        return () => unsub();
      }, [userId]);

      const filtered = useMemo(
        () => employees.filter(e => e.name.toLowerCase().includes((searchQuery||'').toLowerCase())),
        [employees, searchQuery]
      );

      const toggleAdmin = () => {
        if (isAdmin) {
          setIsAdmin(false); setShowPasswordInput(false); setAdminPassword('');
        } else {
          setShowPasswordInput(true);
        }
        setShowFlow(false); setShowCalendar(false); setMessage({text:'',type:''});
      };

      const submitPassword = (e) => {
        e.preventDefault();
        if (adminPassword === correctAdminPassword) {
          setIsAdmin(true); setShowPasswordInput(false); setAdminPassword('');
          setMessage({ text: "Berhasil masuk sebagai Admin!", type: "success" });
        } else {
          setMessage({ text: "Kata sandi salah.", type: "error" });
        }
      };

      const saveLeaves = async (empId) => {
        setIsSaving(s => ({ ...s, [empId]: true }));
        const db = firebase.firestore();
        const emp = employees.find(e => e.id === empId);
        const newLeaves = { ...emp.leaves, ...(editData[empId] || {}) };
        try {
          await db.collection(`artifacts/${appId}/public/data/employees`).doc(empId).set({ ...emp, leaves: newLeaves }, { merge: true });
          setMessage({ text: "Data cuti disimpan.", type: "success" });
        } catch (error) {
          console.error("Gagal menyimpan data cuti pegawai:", error);
          setMessage({ text: "Gagal menyimpan data cuti. Coba lagi.", type: "error" });
        } finally {
          setIsSaving(s => ({ ...s, [empId]: false }));
        }
      };
      
      const updateQuota = async (id, updatedFields) => {
        try {
          const db = firebase.firestore();
          await db.collection(`artifacts/${appId}/public/data/leaveQuotas`).doc(id).set(updatedFields, { merge: true });
          setMessage({ text: "Kuota cuti berhasil diperbarui.", type: "success" });
        } catch (error) {
          console.error("Gagal memperbarui kuota cuti:", error);
          setMessage({ text: "Gagal memperbarui kuota cuti. Coba lagi.", type: "error" });
        }
      };

      const deleteQuota = async (id) => {
        if (!confirm("Hapus jenis cuti ini?")) return;
        try {
          const db = firebase.firestore();
          await db.collection(`artifacts/${appId}/public/data/leaveQuotas`).doc(id).delete();
          setMessage({ text: "Jenis cuti berhasil dihapus.", type: "success" });
        } catch (error) {
          console.error("Gagal menghapus kuota cuti:", error);
          setMessage({ text: "Gagal menghapus kuota cuti. Coba lagi.", type: "error" });
        }
      };
      
      const addEmployee = async (name) => {
        const nm = (name||'').trim();
        if (!nm) return;
        const db = firebase.firestore();
        try {
          await db.collection(`artifacts/${appId}/public/data/employees`).add({ name: nm, leaves: { annual:0, long:0, sick:0, maternity:0, important:0, outside:0 } });
          setMessage({ text: "Pegawai berhasil ditambahkan.", type: "success" });
        } catch (error) {
          console.error("Gagal menambahkan pegawai:", error);
          setMessage({ text: "Gagal menambahkan pegawai. Coba lagi.", type: "error" });
        }
      };

      // Komponen untuk tampilan utama (user)
      const renderDashboard = () => (
        <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10 space-y-6">
          <div className="text-center">
            <img src="https://placehold.co/150x150/f87171/ffffff?text=RRI+Logo" alt="RRI Logo" className="mx-auto w-24 h-24 rounded-full mb-4 shadow-md" />
            <h1 className="text-3xl md:text-4xl font-extrabold text-gray-900 mb-2">Selamat Datang, Karyawan</h1>
            <p className="text-lg text-gray-600">Aplikasi Cuti RRI Sibolga</p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button
              onClick={() => setShowForm(true)}
              className="flex items-center justify-center w-full px-6 py-4 bg-blue-600 text-white font-bold rounded-2xl text-lg hover:bg-blue-700 transition duration-300 shadow-md transform hover:scale-105 btn-focus"
            >
              <i data-lucide="file-plus-2" className="w-6 h-6 mr-2"></i> Ajukan Cuti
            </button>
            <button
              onClick={() => setShowFlow(true)}
              className="flex items-center justify-center w-full px-6 py-4 bg-gray-500 text-white font-bold rounded-2xl text-lg hover:bg-gray-600 transition duration-300 shadow-md transform hover:scale-105 btn-focus"
            >
              <i data-lucide="clock" className="w-6 h-6 mr-2"></i> Lihat Alur Cuti
            </button>
            <button
              onClick={() => setShowCalendar(true)}
              className="col-span-1 md:col-span-2 flex items-center justify-center w-full px-6 py-4 bg-teal-500 text-white font-bold rounded-2xl text-lg hover:bg-teal-600 transition duration-300 shadow-md transform hover:scale-105 btn-focus"
            >
              <i data-lucide="calendar-days" className="w-6 h-6 mr-2"></i> Lihat Kalender
            </button>
          </div>

          <div className="bg-gray-50 rounded-2xl shadow-xl p-6 mt-6 border-t-8 border-yellow-500">
            <h3 className="text-xl font-bold text-gray-800 text-center mb-4">Jenis & Kuota Cuti</h3>
            {leaveQuotas.length > 0 ? (
              leaveQuotas.map((item, idx) => (
                <div key={item.id || idx} className="flex flex-col md:flex-row md:items-center justify-between p-4 my-2 bg-white rounded-lg shadow-sm">
                  <div className="font-semibold text-gray-700">{item.type}</div>
                  <div className="text-gray-500 mt-2 md:mt-0">
                    <span className="font-bold text-lg text-gray-900">{item.quota}</span>
                    {item.note && <span className="text-xs italic text-red-500 ml-2 block md:inline">{item.note}</span>}
                    {item.adminNote && (
                      <div className="text-xs italic text-gray-500 mt-1 md:mt-0 md:ml-4">
                        Catatan Admin: {item.adminNote}
                      </div>
                    )}
                  </div>
                </div>
              ))
            ) : (
              <p className="text-center text-gray-500 italic">Tidak ada data kuota cuti.</p>
            )}
          </div>
          {/* Tombol untuk masuk admin */}
          <div className="text-center mt-6">
            <button onClick={toggleAdmin} className="text-sm text-gray-500 hover:text-gray-700 transition">
              {isAdmin ? 'Keluar dari Admin' : 'Masuk sebagai Admin'}
            </button>
          </div>
        </div>
      );

      // Komponen untuk panel admin
      const renderAdminDashboard = () => (
        <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10 space-y-6">
          <div className="flex items-center justify-between mb-4">
            <button onClick={toggleAdmin} className="text-gray-500 hover:text-gray-700 transition">
              <i data-lucide="chevron-left" className="w-6 h-6"></i>
            </button>
            <h2 className="text-2xl font-bold text-gray-900 flex-grow text-center">Panel Admin</h2>
            <div className="w-6 h-6"></div>
          </div>
          {message.text && (
            <div className={`p-4 rounded-lg text-sm text-center font-medium ${message.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
              {message.text}
            </div>
          )}
          <div className="bg-gray-50 rounded-2xl shadow-inner p-6 space-y-4">
            <h3 className="text-xl font-bold text-gray-800 mb-2 text-center">Manajemen Kuota Cuti</h3>
            {leaveQuotas.length > 0 ? (
              leaveQuotas.map((item, idx) => (
                <div key={item.id || idx} className="bg-white p-4 rounded-lg shadow-sm space-y-2">
                  <div className="flex items-center justify-between">
                    <div className="font-semibold text-gray-700">{item.type}</div>
                    <div className="text-gray-500">{item.quota}</div>
                  </div>
                  <div>
                    <label className="text-sm font-medium text-gray-600 block mb-1">Catatan Admin</label>
                    <input
                      type="text"
                      value={editData[item.id]?.adminNote || item.adminNote || ''}
                      onChange={(e) => setEditData({ ...editData, [item.id]: { ...editData[item.id], adminNote: e.target.value } })}
                      className="w-full p-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Tambahkan catatan..."
                    />
                  </div>
                  <button
                    onClick={() => updateQuota(item.id, { adminNote: editData[item.id]?.adminNote })}
                    className="w-full mt-2 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition"
                  >
                    Simpan Catatan
                  </button>
                </div>
              ))
            ) : (
              <p className="text-center text-gray-500 italic">Tidak ada data kuota untuk dikelola.</p>
            )}
          </div>
        </div>
      );

      // Komponen untuk input password
      const renderPasswordInput = () => (
        <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10 space-y-6 text-center">
          <h2 className="text-2xl font-bold text-gray-900">Masuk sebagai Admin</h2>
          <p className="text-gray-600">Masukkan kata sandi admin.</p>
          <form onSubmit={submitPassword} className="space-y-4">
            <input
              type="password"
              value={adminPassword}
              onChange={(e) => setAdminPassword(e.target.value)}
              className="w-full p-3 border rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Kata Sandi Admin"
              autoFocus
            />
            {message.text && (
              <div className={`p-2 rounded-lg text-sm font-medium ${message.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                {message.text}
              </div>
            )}
            <button
              type="submit"
              className="w-full px-6 py-3 bg-blue-600 text-white font-bold rounded-2xl hover:bg-blue-700 transition shadow-md"
            >
              Masuk
            </button>
          </form>
          <button onClick={() => setShowPasswordInput(false)} className="text-sm text-gray-500 hover:text-gray-700 transition mt-4">
            Batal
          </button>
        </div>
      );

      const renderLeaveForm = () => (
        <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10 space-y-6">
          <div className="flex items-center justify-between mb-4">
            <button onClick={() => setShowForm(false)} className="text-gray-500 hover:text-gray-700 transition">
              <i data-lucide="chevron-left" className="w-6 h-6"></i>
            </button>
            <h2 className="text-2xl font-bold text-gray-900 flex-grow text-center">Formulir Cuti</h2>
            <div className="w-6 h-6"></div>
          </div>
          <p className="text-gray-600 text-center">Isi formulir ini untuk mengajukan permohonan cuti.</p>
          <div className="space-y-4">
            <input type="text" placeholder="Jenis Cuti" className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <input type="date" placeholder="Tanggal Mulai" className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <input type="date" placeholder="Tanggal Selesai" className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-500" />
            <textarea placeholder="Alasan Cuti" rows="4" className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
          </div>
          <button onClick={() => setShowConfirmation(true)} className="w-full px-6 py-3 bg-green-600 text-white font-bold rounded-2xl hover:bg-green-700 transition shadow-md">
            Kirim Permohonan
          </button>
        </div>
      );
      
      const renderFlow = () => (
        <div className="bg-white rounded-3xl shadow-2xl p-6 md:p-10 space-y-6">
          <div className="flex items-center justify-between mb-4">
            <button onClick={() => setShowFlow(false)} className="text-gray-500 hover:text-gray-700 transition">
              <i data-lucide="chevron-left" className="w-6 h-6"></i>
            </button>
            <h2 className="text-2xl font-bold text-gray-900 flex-grow text-center">Alur Pengajuan Cuti</h2>
            <div className="w-6 h-6"></div>
          </div>
          <p className="text-gray-600 text-center">Diagram alir proses pengajuan dan persetujuan cuti.</p>
          <div className="bg-gray-100 p-4 rounded-lg border-2 border-dashed border-gray-300 text-center text-gray-500 h-64 flex items-center justify-center">
            [Placeholder Diagram Alir]
          </div>
        </div>
      );

      const renderConfirmationModal = () => (
        <div className="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center">
          <div className="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full text-center">
            <div className="flex justify-center mb-4">
              <div className="bg-green-100 p-3 rounded-full">
                <i data-lucide="check-circle" className="w-10 h-10 text-green-600"></i>
              </div>
            </div>
            <h3 className="text-2xl font-bold text-gray-900 mb-2">Sukses!</h3>
            <p className="text-gray-600 mb-4">Permohonan cuti Anda berhasil diajukan.</p>
            <button onClick={() => setShowConfirmation(false) || setShowForm(false)} className="w-full px-4 py-2 bg-blue-600 text-white font-bold rounded-full hover:bg-blue-700 transition">
              OK
            </button>
          </div>
        </div>
      );

      if (isLoading) {
        return <div className="text-center text-gray-500">Memuat aplikasi...</div>;
      }
      
      let content;
      if (showPasswordInput) {
        content = renderPasswordInput();
      } else if (isAdmin) {
        content = renderAdminDashboard();
      } else if (showForm) {
        content = renderLeaveForm();
      } else if (showCalendar) {
        content = <Calendar onClose={() => setShowCalendar(false)} />;
      } else if (showFlow) {
        content = renderFlow();
      } else {
        content = renderDashboard();
      }

      return (
        <React.Fragment>
          <Header currentTime={currentTime} />
          {content}
          {showConfirmation && renderConfirmationModal()}
        </React.Fragment>
      );
    }
    
    const container = document.getElementById('root');
    const root = createRoot(container);
    root.render(<App />);

  </script>
</body>
</html>
